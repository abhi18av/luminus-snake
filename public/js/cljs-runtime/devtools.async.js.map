{"version":3,"file":"devtools.async.js","sources":["devtools/async.cljs"],"mappings":";;;;;AAMA,kCAAA,lCAAgBmB;AACd,cAASnB,dADX;;AAGA,gDAAA,hDAAeS;AAEf,+BAAA,/BAAgBC;AACd,OAACU,cAAI,iBAAAC,oBAAK,AAACC,1DADb;AACO,AAAA,oBAAAD;AAAmB,OAACE,8CAAqBd;;AAAzCY;;;;AAEP,wCAAA,xCAAgBI;AACd,QAAA,iKAAA,KAAA,pDAA2EhB,1HAD7E;;AAIA,uCAAA,vCAAeD;AACf,oDAAA,pDAAeI;AAGf,yCAAA,zCAAMI,0FAAyBC;AAA/B,AACE,kBAAA,XAACO;AAAD,AAAgB,MAAOP;GAAvB;;AAEF,6CAAA,7CAAMF,kGAA6Bb;6BAE7B,iBAAAD,9CACA,IAAAA,JAHN,iEACM,iBAAAA,mBAAOD;AAAP,AAAA,OAAA,CAAAC,iBAAA,iBAAAA;;AACA,AAAA,OAAA,CAAAA,iBAAA,cAAAA,iBAAcC;;AACd,AAAA,AAAA,CAAAD,uBAAA,eAAAA,uBAAee;;AAHrB;;AAMA,mDAAA,nDAAML;AAAN,AACE,AAAMC,oDAAyBC;;AAC/B,OAAMA,oCAAwBE;;AAEhC,qDAAA,rDAAMZ;AACJ,OAAMU,oCAAwBD,3CADhC;;AAKA,kCAAA,lCAAME;AAAN,AACEN;;AAEF,+BAAA,/BAAMU;AAAN,AACE,GAAUV;AAAV;;AAAA,AACE,uCAAA,vCAAMA;;AACN,IAAAJ,iBAAME;IAAND,8BAAAD;AAAA,AAAA,oBAAAC;AAAA;AAAA,AAAA,MAAA,KAAAC,MAAA,CAAA,8DAAA,CAAA,4EAAA,MAAA,mDAAAF,2BAAA,KAAA;;;AAAA,CAAAC,4BAAA,qBAAmCE;;AAAnCH;AACA,AAACO;;AACD,oBAAU,CAACD,6DAAAA,+DAAAA;AAAX;AAAA,AACE,AAAO,CAACiB,6DAAAA,+DAAAA,8CAAqB,CAACF,sEAAAA,wEAAAA;;;AALlC;;;AAQF,iCAAA,jCAAMC;AACJ,GAAMlB,HADR;AAEI,uCAAA,vCAAMA,AADR;;AAEE,OAACL;;AAFH","names":["js/Promise","o__27689__auto__","callback","devtools.async/uninstall-async-set-immediate!","G__29793","target__27694__auto__","js/Error","js/Infinity","devtools.async/*installed*","devtools.async/fixed-chrome-version-for-async","devtools.async/needed?","devtools.async/install-async-set-immediate!","devtools.async/*original-set-immediate*","goog.async.nextTick/setImmediate_","devtools.async/installed?","devtools.async/promise-based-set-immediate","devtools.async/rethrow-outside-promise","e","devtools.async/install!","devtools.async/available?","cljs.core/not","and__3911__auto__","goog.labs.userAgent.browser/isChrome","goog.labs.userAgent.browser/isVersionOrHigher","js/setTimeout","devtools.async/get-not-needed-message","devtools.async/uninstall!","devtools.context/get-console"],"sourcesContent":["(ns devtools.async\n  (:require-macros [devtools.oops :refer [oset ocall]])\n  (:require [goog.async.nextTick :as next-tick]\n            [goog.labs.userAgent.browser :as ua]\n            [devtools.context :as context]))\n\n(defn ^:dynamic available? []\n  (exists? js/Promise))\n\n(def ^:dynamic fixed-chrome-version-for-async \"65.0.3321\")\n\n(defn ^:dynamic needed? []\n  (not (and (ua/isChrome) (ua/isVersionOrHigher fixed-chrome-version-for-async))))\n\n(defn ^:dynamic get-not-needed-message []\n  (str \"cljs-devtools: the :async feature is no longer needed since Chrome \" fixed-chrome-version-for-async \", \"\n       \"see https://github.com/binaryage/cljs-devtools/issues/20\"))\n\n(def ^:dynamic *installed* false)\n(def ^:dynamic *original-set-immediate* nil)\n\n; see http://stackoverflow.com/a/30741722/84283\n(defn rethrow-outside-promise [e]\n  (js/setTimeout #(throw e) 0))\n\n(defn promise-based-set-immediate [callback]\n  (-> (ocall js/Promise \"resolve\")\n      (ocall \"then\" callback)\n      (ocall \"catch\" rethrow-outside-promise))\n  nil)\n\n(defn install-async-set-immediate! []\n  (set! *original-set-immediate* next-tick/setImmediate_)\n  (set! next-tick/setImmediate_ promise-based-set-immediate))\n\n(defn uninstall-async-set-immediate! []\n  (set! next-tick/setImmediate_ *original-set-immediate*))\n\n; -- installation -----------------------------------------------------------------------------------------------------------\n\n(defn installed? []\n  *installed*)\n\n(defn install! []\n  (when-not *installed*\n    (set! *installed* true)\n    (oset js/Error [\"stackTraceLimit\"] js/Infinity)\n    (install-async-set-immediate!)\n    (when-not (needed?)\n      (.info (context/get-console) (get-not-needed-message)))\n    true))\n\n(defn uninstall! []\n  (when *installed*\n    (set! *installed* false)\n    (uninstall-async-set-immediate!)))\n"]}